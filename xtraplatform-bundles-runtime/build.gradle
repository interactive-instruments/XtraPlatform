apply plugin: 'maven-publish'

version = '1.0.0'

version += '-SNAPSHOT'

group = 'de.interactive-instruments'

repositories {     
    mavenCentral()
}

configurations {
    bundles {
        transitive = false
    }
}

dependencies {
    
    // logging
    //bundles group: 'org.slf4j', name: 'slf4j-api', version: '1.7.6'
    //bundles group: 'org.slf4j', name: 'log4j-over-slf4j', version: '1.7.6'
    //bundles group: 'org.slf4j', name: 'jul-to-slf4j', version: '1.7.6'
    bundles group: 'org.slf4j', name: 'osgi-over-slf4j', version: '1.7.6'
    //bundles group: 'ch.qos.logback', name: 'logback-classic', version: '1.1.3'
    //bundles group: 'ch.qos.logback', name: 'logback-core', version: '1.1.3'

    // servlet
    //bundles group: 'org.eclipse.jetty.orbit', name: 'javax.servlet', version: '3.0.0.v201112011016'
   
    // TODO
    bundles group: 'de.interactive-instruments', name: 'xtraplatform-dropwizard', version: '1.0.0-SNAPSHOT'

    // felix
    bundles group: 'org.apache.felix', name: 'org.apache.felix.configadmin', version: '1.8.0'
    bundles group: 'org.apache.felix', name: 'org.apache.felix.eventadmin', version: '1.3.2'
    bundles group: 'org.apache.felix', name: 'org.apache.felix.fileinstall', version: '3.5.0'

    // felix http
    bundles group: 'org.apache.felix', name: 'org.apache.felix.http.bridge', version: '2.2.2'
    bundles group: 'org.apache.felix', name: 'org.apache.felix.http.whiteboard', version: '2.2.2'
    
    //felix ipojo
    bundles group: 'org.apache.felix', name: 'org.apache.felix.ipojo', version: '1.12.1'
    bundles group: 'org.apache.felix', name: 'org.apache.felix.ipojo.handler.eventadmin', version: '1.8.0'
    bundles group: 'org.apache.felix', name: 'org.apache.felix.ipojo.handler.whiteboard', version: '1.6.0'
    bundles group: 'org.apache.felix', name: 'org.apache.felix.ipojo.handler.extender', version: '1.4.0'
}

publishing {
    publications {
        maven(MavenPublication) {
            pom.withXml{
                def dependenciesNode = asNode().appendNode('dependencies')

                configurations.bundles.allDependencies.each {
                    def dependencyNode = dependenciesNode.appendNode('dependency')
                    dependencyNode.appendNode('groupId', it.group)
                    dependencyNode.appendNode('artifactId', it.name)
                    dependencyNode.appendNode('version', it.version)
                    dependencyNode.appendNode('scope', 'runtime')
                    
                    def exclusionsNode = dependencyNode.appendNode('exclusions')
                    def exclusionNode = exclusionsNode.appendNode('exclusion')
                    exclusionNode.appendNode('groupId', '*')
                    exclusionNode.appendNode('artifactId', '*')
                }
            }
        }
    }
    repositories {
        maven {
            url "http://nyx/artifactory/libs-snapshot-local"
        }
    }
}
